<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        .App {
            background-image: linear-gradient(to right, rgb(196, 233, 253), rgb(165, 192, 251));
            min-height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .quiz-container {
            width: 60%;
            padding: 30px;
            max-height: 75vh;
            border-radius: 10px;
            background-color: #ffffff;
            overflow-y: scroll;
        }

        .you-quiz-heading {
            font-family: sans-serif;
            text-align: center;
            color: #0F1128;
        }

        .questions-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: start;
            margin: 20px;
            margin-top: 5px;
        }

        .submit-btn {
            background-color: rgb(110, 128, 255);
            border-radius: 7px;
            font-family: sans-serif;
            height: 40px;
            width: 110px;
            color: #ffffff;
            border: none;
            cursor: pointer;
            outline: none;
            margin-top: 20px;
        }

        .questions {
            margin-top: 10px;
        }

        .options {
            list-style: none;
            margin-top: 10px;
        }

        .qno {
            margin-top: 12px;
        }
    </style>
</head>

<body>
    <div class="App">
        <div class="quiz-container">
            <h1 class="you-quiz-heading">You-Quiz</h1>
            <ul class="questions-container" id="questionsContainer">
            </ul>
            <div style="display: flex; justify-content: flex-end;">
                <button class="submit-btn" id="submitButton">Submit</button>
            </div>
        </div>
    </div>


    <script>
        let currentQuestion = 0;

        function parseQuestions(input) {
            const questions = input.trim().split('\n\n');
            return questions.map(questionBlock => {
                const [questionLine, ...optionsLines] = questionBlock.split('\n');
                const question = questionLine.slice(3).trim();
                const options = optionsLines.map(line => line.slice(3).trim());
                return { question, options };
            });
        }

        const questions = parseQuestions(JSON.parse(localStorage.getItem("mcqs")));

        const questionsContainer = document.getElementById("questionsContainer");

        questions.forEach((q, index) => {
            const questionListItem = document.createElement("li");
            questionListItem.classList.add("options");

            const questionTitle = document.createElement("h3");
            questionTitle.textContent = "Question " + (index + 1);
            questionTitle.classList.add("qno");

            const questionText = document.createElement("p");
            questionText.textContent = q.question;
            questionText.classList.add("questions");

            const optionsList = document.createElement("ul");
            q.options.forEach(option => {
                const optionListItem = document.createElement("li");
                optionListItem.classList.add("options");
                const optionInput = document.createElement("input");
                optionInput.setAttribute("type", "radio");
                optionInput.setAttribute("name", "q" + (index + 1));
                optionInput.setAttribute("value", option);
                optionListItem.appendChild(optionInput);
                optionListItem.appendChild(document.createTextNode(option));
                optionsList.appendChild(optionListItem);
            });

            questionListItem.appendChild(questionTitle);
            questionListItem.appendChild(questionText);
            questionListItem.appendChild(optionsList);

            questionsContainer.appendChild(questionListItem);
        });

        // Event listener for submit button
        document.getElementById("submitButton").addEventListener("click", function (event) {
            // Prevent default form submission
            event.preventDefault();

            const selectedOptions = {};

            // Loop through questions and get selected options
            let allAnswered = true;
            questions.forEach((q, index) => {
                const selectedOption = document.querySelector('input[name="q' + (index + 1) + '"]:checked');
                if (selectedOption) {
                    selectedOptions[q.question] = selectedOption.value;
                } else {
                    allAnswered = false;
                }
            });

            // If all questions are answered, proceed with form submission
            if (allAnswered) {
                // Convert selectedOptions object to JSON
                const jsonData = JSON.stringify(selectedOptions);

                // Send the data to the server using AJAX
                fetch("/submit_quiz", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: jsonData
                })
                    .then(response => {
                        if (response.ok) {
                            window.location.href = "/report";
                        } else {
                            alert("Failed to submit quiz answers.");
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        alert("Failed to submit quiz answers.");
                    });
            } else {
                // Show alert if any question is not answered
                alert("Please answer all questions before submitting.");
            }
        });

    </script>
</body>

</html>